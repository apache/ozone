---
- name: "Ozone Non-HA Cluster Deployment"
  hosts: all
  gather_facts: false
  any_errors_fatal: true
  vars:
    cluster_mode: "non-ha"
    ha_enabled: false
  pre_tasks:
    - name: "Pre-install: Ensure python3 present"
      raw: |
        if command -v apt-get >/dev/null 2>&1; then sudo -n apt-get update -y && sudo -n apt-get install -y python3 || true;
        elif command -v dnf >/dev/null 2>&1; then sudo -n dnf install -y python3 || true;
        elif command -v yum >/dev/null 2>&1; then sudo -n yum install -y python3 || true;
        elif command -v zypper >/dev/null 2>&1; then sudo -n zypper --non-interactive in -y python3 || true;
        fi
      args:
        executable: /bin/bash
      changed_when: false
      failed_when: false
    - name: "Pre-install: Gather facts"
      setup:
  roles:
    - role: ozone_user
    - role: ssh_bootstrap
    - role: java
    - role: ozone_layout
    - role: ozone_fetch
    - role: ozone_config
    - role: ozone_service_non_ha
      when: start_after_install | bool

